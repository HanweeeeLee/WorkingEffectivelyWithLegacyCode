# 07. 코드 하나 바꾸는 데 왜 이리 오래 걸리지?
코드를 변경하는 데 얼마나 시간이 걸릴까?  
매우 불명확한 코드를 가지고 작업하는 프로젝트에서 다수의 변경을 수행하려면 오랜 시간이 걸린다.  
코드 중 명확한 부분에 대한 변경 작업은 매우 빨리 진행되지만, 복잡하게 얽혀있는 부분은 해결에 많은 시간이 걸릴 것이다.  
이러한 것들에 대한 해결책으로는 어떤 것들이 있을까?  

## 코드 이해하기
프로젝트에 포함된 코드의 양이 늘어나면 점차 코드 전체를 이해하는데 한계를 느끼기 시작한다.  
무엇을 변경해야 할지 이해하는데 걸리는 시간이 계속 증가하는데, 이는 어느 정도 불가피한 현상이다.  
하지만 꾸준히 관리되는 시스템과 레거시 시스템 간에는 중요한 차이점이 있는데, 적절히 관리되는 시스템이라도 변경 방법을 파악하는데 오랜 시간이 걸릴 수 있지만, 일단 파악 되고 나면 변경 작업 자체는 간단하기 때문에 시스템을 쉽게 다룰 수 있다.  \
하지만 레거시 시스템의 경우 무엇을 해야 할지 이해하는데도 오랜 시간이 걸리고 변경 작업 자체도 힘들다. 또한 변경 작업을 위해 이해해야 할 범위의 일부분만 이해하고 끝나는 경우가 많다.  
적절한 크기를 유지하고, 이름이 제대로 붙여져 있으며, 이해하기 쉬운 부분들로 나뉘어 있는 시스템이라면 코드 변경 작업을 신속하게 수행할 수 있다.

## 지연시간
지연시간 - 변경을 수행한 시점과 그 변경에 대한 실질적인 피드백을 받을 때까지의 시간.  
우리들 대다수는 비효율적으로 보이지만 코드 변경을 수행하고, 빌드를 시작하며 결과를 확인하는 방식으로 소프트웨어를 개발하는데, 이와같은 작업 방식은 대부분의 프로그래밍 언어에서 불필요하다.  
어떤 코드든 간에 대부분의 주요 프로그래밍 언어에서 재컴파일과 테스트를 10초 이내에 실행해 의존관계를 제거할 수 있는데, 그 전제 조건으로는  
시스템 내의 모든 클래스 및 모듈을 다른 클래스 및 모듈과는 독립적으로 별도의 테스트 하네스에서 컴파일 할 수 있어야 한다.  
이것이 가능하다면 매우 빠르게 피드백을 얻을수 있기에 개발 속도가 크게 향상된다.  
인터프리터 언어로 프로그래밍을 하면 거의 즉시 피드백을 얻을수 있다. 그러나 컴파일 언어를 사용할때는 의존관계가 걸림돌이 된다.  
작업 대상 코드를 컴파일하기 위해 관심이 없는 다른 코드도 함께 컴파일 해야 하기 때문이다.

## 의존 관계 제거
의존관계는 문제를 일으킬 수 있지만 다행히도 제거 될 수 있다. 일반적으로 객체 지향 코드에서 가장 먼저 할 일은 테스트 하네스 내에서 클래스의 인스턴스를 생성하는 것인데,  
간단한 경우는 의존중인 클래스를 임포트 하거나 인클루드 하는것으로 충분하다.(그외의 경우에 대한 자세한건 9장, 10장에서 참고하자)  
일반적으로 변경 대상 클래스를 테스트 하네스 내에 넣을 수 있다면 '편집-컴파일-링크-테스트'에 걸리는 시간을 크게 단축할 수 있다.  
레거시 코드일 경우 클래스를 테스트 하네스에 집어 넣는 것부터 막힐 수 있다. 시스템에 따라 이것이 상당한 노력을 요구하게 된다.(자세한 방법은 후에 나온다고 함)

### 빌드 의존 관계
객체 지향 시스템에서 신속히 빌드하고 싶은 클래스 집합이 있는 경우, 가장 먼저 할 일은 어떤 종류의 의존관계가 걸림돌인지 알아내는 것이다.  
일반적으로는 테스트 하네스 내에서 이 클래스들을 사용해보면 된다. 문제가 드러난다면 거의 틀림없이 의존관계로 인한 것이다.  
문제를 해결해 테스트 하네스에서 정상적으로 실행되더라도, 컴파일 시간에 영향을 주는 의존관계는 여전히 남아있으므로 이 클래스들에 의존하는 다른 클래스들을 파악해야 한다.  
시스템을 다시 빌드할때 반드시 재 컴파일 돼야 하는 것들이기 때문이다. 그렇다면 재컴파일 돼야 하는 클래스를 어떻게 최소화 할 수 있을까?  
이 문제를 해결하려면 클래스 집합 외부의 클래스가 사용하는 클래스 집합 내부의 클래스에 대한 인터페이스를 추출해야 한다.  
다른 방법으로는 클래스 집합을 테스트 루틴으로 보호한 후에 빌드하기 쉽도록 프로젝트의 물리적 구조를 변경하는 방법도 생각 할 수 있다.  
두번째 방법은 빌드가 복잡해질 수 있으나 그럴만한 중요한 이유가 있는데, 의존관계를 제거하고 클래스들을 새로운 패키지나 라이브러리로 이동할수록  
시스템 전체의 재빌드 비용은 조금 늘어나지만, 개별 빌드에 걸리는 평균시간은 감소한다.  
의존관계를 제거하고, 클래스를 다수의 패키지로 분산시킴으로서 빌드 시간을 줄일 수 있다. 이는 매우 큰 의미가 있는데,  
테스트 루틴의 재빌드 및 실행 속도를 높인다 -> 개발과정에서 더 많은 피드백을 얻을 수 있다 -> 이는 곧 더 적은 오류와 장애를 의미한다  
그러나 공짜는 아니다. 인터페이스와 패키지 개수가 늘어나므로 개념적으로 부담이 늘기 때문이다. 그래도 이런 기법을 시도할 가치가 있다.  
패키지와 인터페이스 개수가 늘어나서 조사하는 시간은 늘어나지만, 변경작업은 훨씬 쉬워 질 것이다.
